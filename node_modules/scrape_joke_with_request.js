

const cheerio = require('cheerio');
const request = require('request');


const url = 'https://www.fmylife.com/random/';

function Joke()
{
}

Joke.prototype.aJoke = function()
{
		request(url, (error, response, html) => {
		
		if(!error)
		{
			var content = cheerio.load(html);
			//content(".panel-content").filter( () =>
			//content(".panel-content > a").each( () =>
			var data = content(".panel-content");
			//{
				//var link = content(this);
			var text_content = data.children().first().children().first().text().trim(); // a
			console.log(text_content);
			console.log("Process finished.");
			return text_content;
			//})
		}
		else
		{
			console.log("A mysterious error happened! :( ");
			return "There is an error";
		}
	})
}

async Joke.prototype.retrieveJoke = function()
{
	//let j = new sJoke();
	let text_content = await aJoke();
	if(text_content === null)
		console.log("The text received is null");
	else
		console.log("The text received is NOT null");
	//bot.setTimeout(msg.channel.send, 6000, `Here is your joke: ${text_content}`);
	console.log("SECOND : " + text_content);
	return text_content;
}

exports = module.exports = Joke;
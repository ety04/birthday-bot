
const request = require('superagent')
var cheerio = require('cheerio')


const url = 'http://www.fmylife.com/index.php/random';


/**
 * -----> aJoke
 * Makes an HTTP request to retrieve a joke from a website
 * @param {void}
 * @resolve {String} 	: a very good one
 */
function aJoke()
{
	try{
		return new Promise( (resolve, reject) => {
			request.get(url, (res, err) => {
				if(err)
				{
					console.log("ERROR REQUESTING: " + err.text);
					reject(err);
				}
				var source = cheerio.load(res.text);
				resolve(source('div.panel-content').children().first().children().first().text());
				reject("error retrieving the joke");
			});
		});
	}
	catch(err)
	{
		console.log("ERROR SCRAPING: " + err);
		return err;
	}
}

/**
 * -----> retrieveJoke
 * The asynchronous call to aJoke to grab the joke's text
 * @param {void}
 * @return text_content {String}	 : a very good one
 */
async function retrieveJoke()
{
	var text_content = await aJoke();
	if(text_content === null)
		console.log("The text received is null");
	else
		console.log("The text received is NOT null");
	return text_content;
}

exports = module.exports = retrieveJoke;